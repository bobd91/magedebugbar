/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.16 Copyright (c) 2010-2015, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

(function(){var requirejs,require,define;(function(global){function isFunction(e){return ostring.call(e)==="[object Function]"}function isArray(e){return ostring.call(e)==="[object Array]"}function each(e,t){if(e){var n;for(n=0;n<e.length;n+=1)if(e[n]&&t(e[n],n,e))break}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1;n-=1)if(e[n]&&t(e[n],n,e))break}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){if(n||!hasProp(e,i))r&&typeof t=="object"&&t&&!isArray(t)&&!isFunction(t)&&!(t instanceof RegExp)?(e[i]||(e[i]={}),mixin(e[i],t,n,r)):e[i]=t}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function m(e){var t,n;for(t=0;t<e.length;t++){n=e[t];if(n===".")e.splice(t,1),t-=1;else if(n===".."){if(t===0||t==1&&e[2]===".."||e[t-1]==="..")continue;t>0&&(e.splice(t-1,2),t-=2)}}}function g(e,t,n){var r,i,s,u,a,f,l,c,h,p,d,v,g=t&&t.split("/"),y=o.map,b=y&&y["*"];e&&(e=e.split("/"),l=e.length-1,o.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),e[0].charAt(0)==="."&&g&&(v=g.slice(0,g.length-1),e=v.concat(e)),m(e),e=e.join("/"));if(n&&y&&(g||b)){s=e.split("/");e:for(u=s.length;u>0;u-=1){f=s.slice(0,u).join("/");if(g)for(a=g.length;a>0;a-=1){i=getOwn(y,g.slice(0,a).join("/"));if(i){i=getOwn(i,f);if(i){c=i,h=u;break e}}}!p&&b&&getOwn(b,f)&&(p=getOwn(b,f),d=u)}!c&&p&&(c=p,h=d),c&&(s.splice(0,h,c),e=s.join("/"))}return r=getOwn(o.pkgs,e),r?r:e}function y(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===r.contextName)return t.parentNode.removeChild(t),!0})}function b(e){var t=getOwn(o.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),r.require.undef(e),r.makeRequire(null,{skipMap:!0})([e]),!0}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e,t,n,i){var s,o,u,a,f=null,l=t?t.name:null,h=e,p=!0,m="";return e||(p=!1,e="_@r"+(d+=1)),a=w(e),f=a[0],e=a[1],f&&(f=g(f,l,i),o=getOwn(c,f)),e&&(f?o&&o.normalize?m=o.normalize(e,function(e){return g(e,l,i)}):m=e.indexOf("!")===-1?g(e,l,i):e:(m=g(e,l,i),a=w(m),f=a[0],m=a[1],n=!0,s=r.nameToUrl(m))),u=f&&!o&&!n?"_unnormalized"+(v+=1):"",{prefix:f,name:m,parentMap:t,unnormalized:!!u,url:s,originalName:h,isDefine:p,id:(f?f+"!"+m:m)+u}}function S(e){var t=e.id,n=getOwn(u,t);return n||(n=u[t]=new r.Module(e)),n}function x(e,t,n){var r=e.id,i=getOwn(u,r);hasProp(c,r)&&(!i||i.defineEmitComplete)?t==="defined"&&n(c[r]):(i=S(e),i.error&&t==="error"?n(i.error):i.on(t,n))}function T(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=getOwn(u,t);n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function N(){globalDefQueue.length&&(apsp.apply(l,[l.length,0].concat(globalDefQueue)),globalDefQueue=[])}function C(e){delete u[e],delete a[e]}function k(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,each(e.depMaps,function(r,i){var s=r.id,o=getOwn(u,s);o&&!e.depMatched[i]&&!n[s]&&(getOwn(t,s)?(e.defineDep(i,c[s]),e.check()):k(o,t,n))}),n[r]=!0)}function L(){var e,n,i=o.waitSeconds*1e3,u=i&&r.startTime+i<(new Date).getTime(),f=[],l=[],c=!1,h=!0;if(t)return;t=!0,eachProp(a,function(e){var t=e.map,r=t.id;if(!e.enabled)return;t.isDefine||l.push(e);if(!e.error)if(!e.inited&&u)b(r)?(n=!0,c=!0):(f.push(r),y(r));else if(!e.inited&&e.fetched&&t.isDefine){c=!0;if(!t.prefix)return h=!1}});if(u&&f.length)return e=makeError("timeout","Load timeout for modules: "+f,null,f),e.contextName=r.contextName,T(e);h&&each(l,function(e){k(e,{},{})}),(!u||n)&&c&&(isBrowser||isWebWorker)&&!s&&(s=setTimeout(function(){s=0,L()},50)),t=!1}function A(e){hasProp(c,e[0])||S(E(e[0],null,!0)).init(e[1],e[2])}function O(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function M(e){var t=e.currentTarget||e.srcElement;return O(t,r.onScriptLoad,"load","onreadystatechange"),O(t,r.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function _(){var e;N();while(l.length){e=l.shift();if(e[0]===null)return T(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));A(e)}}var t,n,r,i,s,o={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},u={},a={},f={},l=[],c={},h={},p={},d=1,v=1;return i={require:function(e){return e.require?e.require:e.require=r.makeRequire(e.map)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports?c[e.map.id]=e.exports:e.exports=c[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(o.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},n=function(e){this.events=getOwn(f,e.id)||{},this.map=e,this.shim=getOwn(o.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},n.prototype={init:function(e,t,n,r){r=r||{};if(this.inited)return;this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check()},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(this.fetched)return;this.fetched=!0,r.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();r.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))},load:function(){var e=this.map.url;h[e]||(h[e]=!0,r.load(this.map.id,e))},check:function(){if(!this.enabled||this.enabling)return;var e,t,n=this.map.id,i=this.depExports,s=this.exports,o=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{s=r.execCb(n,o,i,s)}catch(u){e=u}else s=r.execCb(n,o,i,s);this.map.isDefine&&s===undefined&&(t=this.module,t?s=t.exports:this.usingExports&&(s=this.exports));if(e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",T(this.error=e)}else s=o;this.exports=s,this.map.isDefine&&!this.ignore&&(c[n]=s,req.onResourceLoad&&req.onResourceLoad(r,this.map,this.depMaps)),C(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var e=this.map,t=e.id,n=E(e.prefix);this.depMaps.push(n),x(n,"defined",bind(this,function(n){var i,s,a,f=getOwn(p,this.map.id),l=this.map.name,c=this.map.parentMap?this.map.parentMap.name:null,h=r.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){n.normalize&&(l=n.normalize(l,function(e){return g(e,c,!0)})||""),s=E(e.prefix+"!"+l,this.map.parentMap),x(s,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),a=getOwn(u,s.id),a&&(this.depMaps.push(s),this.events.error&&a.on("error",bind(this,function(e){this.emit("error",e)})),a.enable());return}if(f){this.map.url=r.nameToUrl(f),this.load();return}i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(u,function(e){e.map.id.indexOf(t+"_unnormalized")===0&&C(e.map.id)}),T(e)}),i.fromText=bind(this,function(n,s){var u=e.name,a=E(u),f=useInteractive;s&&(n=s),f&&(useInteractive=!1),S(a),hasProp(o.config,t)&&(o.config[u]=o.config[t]);try{req.exec(n)}catch(l){return T(makeError("fromtexteval","fromText eval for "+t+" failed: "+l,l,[t]))}f&&(useInteractive=!0),this.depMaps.push(a),r.completeLoad(u),h([u],i)}),n.load(e.name,h,i,o)})),r.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){a[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,s,o;if(typeof e=="string"){e=E(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,o=getOwn(i,e.id);if(o){this.depExports[t]=o(this);return}this.depCount+=1,x(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback?x(e,"error",bind(this,this.errback)):this.events.error&&x(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,s=u[n],!hasProp(i,n)&&s&&!s.enabled&&r.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(u,e.id);t&&!t.enabled&&r.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),e==="error"&&delete this.events[e]}},r={config:o,contextName:e,registry:u,defined:c,urlFetched:h,defQueue:l,Module:n,makeModuleMap:E,nextTick:req.nextTick,onError:T,configure:function(e){e.baseUrl&&e.baseUrl.charAt(e.baseUrl.length-1)!=="/"&&(e.baseUrl+="/");var t=o.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){n[t]?(o[t]||(o[t]={}),mixin(o[t],e,!0,!0)):o[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(p[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,n){isArray(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=r.makeShimExports(e)),t[n]=e}),o.shim=t),e.packages&&each(e.packages,function(e){var t,n;e=typeof e=="string"?{name:e}:e,n=e.name,t=e.location,t&&(o.paths[n]=e.location),o.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(u,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=E(t))}),(e.deps||e.callback)&&r.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,n){function s(o,a,f){var l,h,p;return n.enableBuildCallback&&a&&isFunction(a)&&(a.__requireJsBuild=!0),typeof o=="string"?isFunction(a)?T(makeError("requireargs","Invalid require call"),f):t&&hasProp(i,o)?i[o](u[t.id]):req.get?req.get(r,o,t,s):(h=E(o,t,!1,!0),l=h.id,hasProp(c,l)?c[l]:T(makeError("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(_(),r.nextTick(function(){_(),p=S(E(null,t)),p.skipMap=n.skipMap,p.init(o,a,f,{enabled:!0}),L()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var n,i=e.lastIndexOf("."),s=e.split("/")[0],o=s==="."||s==="..";return i!==-1&&(!o||i>1)&&(n=e.substring(i,e.length),e=e.substring(0,i)),r.nameToUrl(g(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(c,E(e,t,!1,!0).id)},specified:function(e){return e=E(e,t,!1,!0).id,hasProp(c,e)||hasProp(u,e)}}),t||(s.undef=function(e){N();var n=E(e,t,!0),r=getOwn(u,e);y(e),delete c[e],delete h[n.url],delete f[e],eachReverse(l,function(t,n){t[0]===e&&l.splice(n,1)}),r&&(r.events.defined&&(f[e]=r.events),C(e))}),s},enable:function(e){var t=getOwn(u,e.id);t&&S(e).enable()},completeLoad:function(e){var t,n,r,i=getOwn(o.shim,e)||{},s=i.exports;N();while(l.length){n=l.shift();if(n[0]===null){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);A(n)}r=getOwn(u,e);if(!t&&!hasProp(c,e)&&r&&!r.inited){if(o.enforceDefine&&(!s||!getGlobal(s))){if(b(e))return;return T(makeError("nodefine","No define call for "+e,null,[e]))}A([e,i.deps||[],i.exportsFn])}L()},nameToUrl:function(e,t,n){var i,s,u,a,f,l,c,h=getOwn(o.pkgs,e);h&&(e=h),c=getOwn(p,e);if(c)return r.nameToUrl(c,t,n);if(req.jsExtRegExp.test(e))f=e+(t||"");else{i=o.paths,s=e.split("/");for(u=s.length;u>0;u-=1){a=s.slice(0,u).join("/"),l=getOwn(i,a);if(l){isArray(l)&&(l=l[0]),s.splice(0,u,l);break}}f=s.join("/"),f+=t||(/^data\:|\?/.test(f)||n?"":".js"),f=(f.charAt(0)==="/"||f.match(/^[\w\+\.\-]+:/)?"":o.baseUrl)+f}return o.urlArgs?f+((f.indexOf("?")===-1?"?":"&")+o.urlArgs):f},load:function(e,t){req.load(r,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if(e.type==="load"||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=M(e);r.completeLoad(t.id)}},onScriptError:function(e){var t=M(e);if(!b(t.id))return T(makeError("scripterror","Script error for: "+t.id,e,[t.id]))}},r.require=r.makeRequire(),r}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(e){if(e.readyState==="interactive")return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.16",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=typeof window!="undefined"&&typeof navigator!="undefined"&&!!window.document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(e,t,n,r){var i,s,o=defContextName;return!isArray(e)&&typeof e!="string"&&(s=e,isArray(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),i=getOwn(contexts,o),i||(i=contexts[o]=req.s.newContext(o)),s&&i.configure(s),i.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick=typeof setTimeout!="undefined"?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var r=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return r.type=e.scriptType||"text/javascript",r.charset="utf-8",r.async=!0,r},req.load=function(e,t,n){var r=e&&e.config||{},i;if(isBrowser)return i=req.createNode(r,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),e.completeLoad(t)}catch(s){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,s,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){head||(head=e.parentNode),dataMain=e.getAttribute("data-main");if(dataMain)return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var r,i;typeof e!="string"&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(n.length===1?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),define("requireLib",function(){}),require.config({baseUrl:"/js/MageDebugBar",paths:{ace:"https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.8","ace/theme/chrome":"https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.8/theme-chrome"},shim:{"ace/ace":{exports:"ace"}}}),define("config",function(){}),define("phpdebugbar",[],function(){return PhpDebugBar}),define("jquery",["phpdebugbar"],function(e){return e.$}),define("class",{create:function(e){return this.extend(Object,e)},extend:function(e,t){var n=Object.create(e.prototype),r;return Object.getOwnPropertyNames(t).forEach(function(e){n[e]=t[e]}),n.super=e.prototype,r=n.hasOwnProperty("constructor")?n.constructor:function(){},r.prototype=n,r}}),define("cssclass",{generate:function(e,t){var n={};return t.forEach(function(t){var r=n,i=t.split("-"),s=i.length-1;i.slice(0,s).forEach(function(e){r[e]=r[e]||{},r=r[e]}),r[i[s]]="magedebugbar-"+e+"-"+t}),n}}),define("layoutmodel",["class"],function(e){return e.create({constructor:function(e){this.layout=e,this.pageBlocks={},this.processPageBlocks(e.blocks.blocks),this.configBlocks={},this.rootBlocks=[],this.handleBlocks={},e.config.handles.forEach(function(e){this.handleBlocks[e.name]=[],this.processConfigBlocks(e.elems,e.name)},this)},processPageBlocks:function(e){e.forEach(function(e){this.processPageBlock(e)},this)},processPageBlock:function(e){this.pageBlocks[e.name]=e,this.processPageBlocks(e.blocks)},getPageBlocks:function(){return this.layout.blocks},getHandles:function(){return this.layout.config.handles},validHandle:function(e){var t=!1;return this.layout.config.handles.map(function(n){t=t||e===n.name}),t},getStore:function(){return this.layout.store},getHandleBlocks:function(e){return e?this.handleBlocks[e]:this.rootBlocks},splitHelper:function(e){var t=e.split("/"),n=t.slice(0,-1).join("/"),r=t[t.length-1];return{alias:n,method:r}},findBlock:function(e){var t=this.layout.config.handles;for(var n=0;n<t.length;n++){var r=this.findBlockInElems(e,t[n].elems);if(r)return r}},findBlockInElems:function(e,t){if(t)for(var n=0;n<t.length;n++){var r=this.findBlockInElem(e,t[n]);if(r)return r}},findBlockInElem:function(e,t){return t.name==="block"&&t.attrs&&e===t.attrs.name?t:this.findBlockInElems(e,t.elems)},findTemplateFile:function(e,t){t=t||[this.layout.blocks];for(var n=0;n<t.length;n++){if(t[n].template===e)return t[n].template_file;if(t[n].blocks){var r=this.findTemplateFile(e,t[n].blocks);if(r)return r}}},configFileName:function(e){return this.layout.config.files[e]},processConfigBlocks:function(e,t,n){e.forEach(function(e){this.processConfigBlock(e,t,n)},this)},processConfigBlock:function(e,t,n){this.functionFor(e)(e,t,n),this.processConfigBlocks(e.elems,t,e)},functionFor:function(e){var t="process_"+e.name,n=Object.getPrototypeOf(this).hasOwnProperty(t)?this[t]:this.skipElement;return n.bind(this)},skipElement:function(){},process_block:function(e,t,n){var r=e.attrs.name,i={name:r,handle:t,rendered:typeof this.pageBlocks[r]!="undefined",parent:n,blocks:[],actions:[],elem:e};this.configBlocks[r]=i;if(n){var s=this.configBlocks[n.attrs.name];s&&(s.blocks.push(i),s.handle!==t&&-1===this.handleBlocks[t].indexOf(s)&&this.handleBlocks[t].push(i))}else e.attrs.output&&(this.rootBlocks.push(i),this.handleBlocks[t].push(i))},process_remove:function(e,t,n){var r=this.configBlocks[e.attrs.name];r&&(r.handle!==t&&-1===this.handleBlocks[t].indexOf(r)&&this.handleBlocks[t].push(r),r.removedBy={handle:t,elem:e})},process_action:function(e,t,n){var r={action:this.formatAction(e),ifconfig:e.attrs.ifconfig,handle:t,elem:e},i=this.configBlocks[n.attrs.name];i&&(i.handle!==t&&-1===this.handleBlocks[t].indexOf(i)&&this.handleBlocks[t].push(i),i.actions.push(r))},formatAction:function(e){return e.attrs.method+"("+this.formatArgs(e)+")"},formatArgs:function(e){var t=[];return e.elems.forEach(function(e){t.push(this.formatArg(e))},this),t.join(", ")},formatArg:function(e){var t=e.attrs.helper;if(t)return t=this.splitHelper(t),t.alias+"->"+t.method+"()";if(e.elems.length)return this.flattenElems(e.elems);var n=e.data;return n.length?isNaN(+n)?"'"+n+"'":n:"null"},flattenElems:function(e){return e.map(this.flattenElem,this).join("")},flattenElem:function(e){var t="<"+e.name+">";return e.elems.length?t+=flattenElems(e.elems):t+=e.data,t+="</"+e.name+">",t}})}),define("clipboard",["jquery","cssclass","class"],function(e,t,n){var r=t.generate("clipboard",["container","textarea"]),i=n.create({constructor:function(){this.$container=e("<div />").attr("id",r.container).appendTo(e("body")),this.$textarea=e("<textarea />").attr("id",r.textarea),e(document).on("keydown",this.keydown.bind(this)).on("keyup",this.keyup.bind(this))},set:function(e){this.text=e},unset:function(){delete this.text},keydown:function(t){if(!this.text||!t.ctrlKey&&!t.metaKey||e(t.target).is("input:visible,textarea:visible")||window.getSelection().toString())return;setTimeout(function(){this.$container.empty().show(),this.$textarea.val(this.text).appendTo(this.$container).focus().select()}.bind(this),0)},keyup:function(e){this.$container.length&&this.$container.empty().hide()}});return new i}),define("tabbox",["jquery","class","cssclass","clipboard"],function(e,t,n,r){var i=n.generate("tab",["box","content","active","close","icon-cross","icon-close"]);return t.create({constructor:function(){this.$box=e("<div />").addClass(i.box),this.$tabs=e("<ul />").appendTo(this.$box),this.$content=e("<div />").addClass(i.content).appendTo(this.$box),this.$tabs.on("click","li",this.clickTab.bind(this)).on("click","."+i.close,this.clickCloseTab.bind(this))},activeClass:function(){return i.active},appendTo:function(e){this.$box.appendTo(e),this.resize()},resize:function(){this.$content.outerHeight(this.$box.innerHeight()-this.$tabs.outerHeight())},clickTab:function(t){t.isDefaultPrevented()||(this.activateTab(e(t.currentTarget)),t.preventDefault())},clickCloseTab:function(t){t.isDefaultPrevented()||(this.removeTab(e(t.currentTarget).parent()),t.preventDefault())},getTabContent:function(e){return e.data("tab-content")},setTabContent:function(e,t){e.data("tab-content",t)},addTab:function(t){var n=e("<li />").text(t.label);t.$html&&t.$html.appendTo(n),t.title&&(n.attr("title",t.title),n.hover(function(){r.set(t.title)},function(){r.unset()}));if(t.closeable){var s=e("<span />").addClass(i.close);e("<i />").addClass(i.icon.cross).appendTo(s),e("<i />").addClass(i.icon.close+" fa fa-times-circle icon").appendTo(s),s.appendTo(n)}return this.$tabs.append(n),t.add(this),this.setTabContent(n,t),this.resize(),n},removeTab:function(e){var t=e.hasClass(i.active),n=e.siblings().length,r=e.index();this.getTabContent(e).remove(),e.remove();if(t&&n){n===r&&r--;var s=this.$tabs.children().eq(r);this.activateTab(s)}0===this.tabCount()&&this.hideContent()},removeOtherTabs:function(t){var n=t.get(0);this.$tabs.children().each(function(t,r){r!==n&&e(r).remove()}),this.activateTab(t)},removeAllTabs:function(){this.$tabs.empty(),this.hideContent()},activateTab:function(e){this.$box.find("."+i.active).removeClass(i.active),e.addClass(i.active),this.getTabContent(e).activate(),1==this.tabCount()&&this.showContent()},tabCount:function(){return this.$tabs.children().length},hideContent:function(){this.$content.css("visibility","hidden")},showContent:function(){this.$content.css("visibility","visible")},getContent:function(){return this.$content}})}),define("tabcontent",["class"],function(e){return e.create({constructor:function(e,t,n,r,i){this.label=e,this.title=r,this.closeable=n,this.$ui=t,this.$html=i},add:function(e){this.tabbox=e,this.$ui.appendTo(e.getContent())},activate:function(){this.$ui.addClass(this.tabbox.activeClass())},remove:function(){this.$ui.remove()}})}),define("treegridview",["jquery","class","cssclass"],function(e,t,n){var r=n.generate("treegridview",["container","open","closed","leaf","cell","hover"]);return t.create({constructor:function(e){this.model=e},appendTo:function(t){var n=e("<table />").addClass(r.container).appendTo(t);return this.container=n,this.addColGroup(n),this.addHeadings(n),this.addRoot(n),this.addHandlers(n),n},resetRoot:function(e){this.container.has("tbody").children().remove(),this.model.root=e,this.addRoot(this.container)},addColGroup:function(t){if(this.model.columns){var n=e("<colgroup />").appendTo(t);this.model.columns.forEach(function(t){e("<col>").addClass(t).appendTo(n)})}},addHeadings:function(t){if(this.model.headings){var n=e("<thead />").appendTo(t),r=e("<tr />").appendTo(n);this.model.headings.forEach(function(t){e("<th>"+t+"</th>").appendTo(r)})}},addRoot:function(e){var t=this.model.root[this.model.children],n;this.insertRows(t,1,e,!0),t.length==1&&(n=e.find("."+r.closed),n.length&&this.open({target:n}))},makeRow:function(t,n){var i=e("<tr />");return this.model.values.forEach(function(s,o){var u=e("<td />").appendTo(i);if(o===0){u.css("padding-left",n-1+".3em");var a=this.hasChildren(t)?r.closed:r.leaf;e("<div />").addClass(a).addClass("fa fa-play icon").appendTo(u)}var f=e("<div>"+t[s]+"</div>").addClass(r.cell).appendTo(u);o===0&&f.css("margin-left",".5em")},this),i},hasChildren:function(e){return 0<e[this.model.children].length},addHandlers:function(e){e.on("click","."+r.open,this.close.bind(this)),e.on("click","."+r.closed,this.open.bind(this)),e.on("click","."+r.cell,this.click.bind(this))},open:function(t){var n=e(t.target);n.removeClass(r.closed).removeClass("fa-play icon").addClass("fa-spinner fa-pulse");var i=this.findRow(t);Promise.resolve(i.branch[this.model.children]).then(function(e){this.insertRows(e,1+i.level,i.element)}.bind(this)).catch(function(e){console.error(e)}).then(function(){n.removeClass("fa-spinner fa-pulse").addClass(r.open).addClass("fa-play fa-rotate-90 icon")}.bind(this))},insertRows:function(e,t,n,r){e.forEach(function(e){n=this.insertRow(e,t,n,r),r=!1},this)},insertRow:function(e,t,n,r){var i=this.makeRow(e,t);return r?i=i.appendTo(n):i=i.insertAfter(n),i.hover(this.hover.bind(this),this.unhover.bind(this)).data("branch",e).data("level",t)},findRow:function(t){var n=e(t.target).closest("tr"),r=n.data();return r.element=n,r},findCol:function(t){var n=e(t.target).closest("tr"),r;return n.children().each(function(n,i){r===undefined&&e(i).has(t.target).length&&(r=n)}),r},close:function(t){var n=this.findRow(t),i=!0;n.element.nextAll().filter(function(t,r){return i=i&&e(r).data().level>n.level,i}).remove(),e(t.target).removeClass(r.open).removeClass("fa-rotate-90").addClass(r.closed)},click:function(t){e(this).trigger("click",[this.findRow(t),this.findCol(t)])},hover:function(t){t&&(e(t.currentTarget).addClass(r.hover),e(this).trigger("hover",[!0,this.findRow(t)]))},unhover:function(t){e(t.currentTarget).removeClass(r.hover),e(this).trigger("hover",[!1,this.findRow(t)])}})}),define("pageview",["jquery","class","cssclass","tabcontent","treegridview"],function(e,t,n,r,i){var s=n.generate("page",["view"]);return t.extend(r,{constructor:function(t,n,r){this.super.constructor.call(this,"Page",e("<div />").addClass(s.view)),this.treeview=new i(this.makeRootModel(n.getPageBlocks())),e(this.treeview).on("click",function(e,n,r){switch(r){case 0:t.loadBlock(n.branch.name);break;case 1:t.loadBlockClass(n.branch.type);break;case 2:t.loadTemplate(n.branch.template)}}).on("hover",function(e,t,n){t?r.show(n.branch.name,n.branch.id):r.hide()})},add:function(e){this.super.add.call(this,e),this.treeview.appendTo(this.$ui)},makeRootModel:function(e){return{children:"blocks",values:["name","type","template"],root:e}}})}),define("handleview",["jquery","class","cssclass","tabcontent","treegridview"],function(e,t,n,r,i){var s=n.generate("handle",["view","chooser","icon-rendered","icon-configured","icon-forced","icon-action","icon-ifconfig","icon-remove"]);return t.extend(r,{constructor:function(t,n){this.super.constructor.call(this,"Handles",e("<div />").addClass(s.view),!1,undefined,this.handleChooser(n)),this.treeview=new i(this.makeRootModel(n)),e(this.treeview).on("click",function(e,r,i){var s=r.branch.elem.file,o=r.branch.elem.line;s!==undefined&&o!==undefined&&t.loadFile(n.configFileName(s),o)})},handleChooser:function(t){var n=e("<select />").attr("id",s.chooser);return n.append(e("<option />").attr("selected","true").text("(all)")),t.getHandles().forEach(function(t){n.append(e("<option />").text(t.name))}),n.on("change",function(n){var r=e(n.target).val(),i;r==="(all)"?i={blocks:this.blocksToHtml(t.getHandleBlocks())}:i={blocks:this.blocksToHtml(t.getHandleBlocks(r),r,!0)},this.treeview.resetRoot(i)}.bind(this)),n},add:function(e){this.super.add.call(this,e),this.treeview.appendTo(this.$ui)},makeRootModel:function(e){return{children:"blocks",values:["html"],root:{blocks:this.blocksToHtml(e.getHandleBlocks())}}},blocksToHtml:function(e,t,n){return e.map(function(e){return this.blockToHtml(e,t,n)},this).filter(function(e){return e})},blockToHtml:function(e,t,n){var r,i,s;if(e.removedBy&&(!t||t===e.removedBy.handle))r=this.removeIcon()+e.name,i=[],s=e.removedBy.elem;else{if(!n&&!!t&&t!==e.handle)return;var o=t&&t!==e.handle;r=this.blockIcon(e.rendered,o)+e.name,i=this.actionsToHtml(e.actions,t).concat(this.blocksToHtml(e.blocks,t)),s=e.elem}return{html:r,blocks:i,elem:s}},actionsToHtml:function(e,t){return e.map(function(e){return this.actionToHtml(e,t)},this).filter(function(e){return e})},actionToHtml:function(e,t){if(t&&t!==e.handle)return;return{html:this.actionIcon(e.ifconfig)+this.escapeHtml(e.action),blocks:[],elem:e.elem}},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(e).replace(/[&<>"'\/]/g,function(e){return t[e]})},blockIcon:function(e,t){var n,r;return e?t?(r=s.icon.forced,n="Rendered block from another handle"):(r=s.icon.rendered,n="Rendered block"):(r=s.icon.configured,n="Non-rendered block"),this.icon("fa-cube",r,n)},removeIcon:function(){return this.icon("fa-cube",s.icon.remove,"Removed block")},actionIcon:function(e){return this.icon("fa-gears",e?s.icon.ifconfig:s.icon.action,e?"Action with ifconfig":"Action")},icon:function(e,t,n){return"<i class='fa icon "+e+" "+" "+t+"' "+(n?"title='"+n+"'":"")+" />"}})}),define("layouthighlighter",["jquery","class","cssclass"],function(e,t,n){var r=n.generate("highlight",["block","tooltip","point-top","point-bottom","point-left","point-right"]);return t.create({constructor:function(){this.$block=e("<div />").addClass(r.block),this.$tooltip=e("<span />").addClass(r.tooltip),e("body").append(this.$block).append(this.$tooltip)},show:function(t,n){var r=e("[data-blockid='"+n+"']");if(2===r.length){var i=this.combineBounds(r.eq(0),r.eq(1));i&&(this.showBlock(i),this.showToolTip(i,t))}},hide:function(){this.$block.hide(),this.$tooltip.hide()},showBlock:function(e){this.$block.css({top:e.top,left:e.left,width:e.right-e.left,height:e.bottom-e.top}).show()},showToolTip:function(e,t){this.clearLocationClass(),this.$tooltip.text(t);var n=this.tipBoxHeight,r=this.tipBoxWidth*t.length,i=this.getScreenBounds(),s=this.possibleTipLocation(e,i,(i.right-i.left)/8,(i.bottom-i.top)/8),o=this.possibleTipLocation(e,i,r,n),u=this.fallbackTipLocation(o),a=this.displayFn(s)||this.displayFn(o)||this.displayFn(u);a.call(this,e,i,n,r),this.$tooltip.show()},getScreenBounds:function(){var t=e("body");return{top:t.scrollTop(),right:window.innerWidth+t.scrollLeft(),bottom:e(".phpdebugbar").offset().top,left:t.scrollLeft()}},possibleTipLocation:function(e,t,n,r){return{top:e.top>=r,right:e.right<=t.right-n,bottom:e.bottom<=t.bottom-r,left:e.left>=n}},fallbackTipLocation:function(e){return{top:e.top,right:e.right,left:e.left||!e.right,bottom:e.bottom||!e.top}},combineBounds:function(e,t){if(e.parent().css("display")==="none")return;var n,r,i,s,o,u=!1;for(var a=e.next();!a.is(t)&&a.length;a=a.next())i=a.css("display"),(n=a.offset())&&i!=="none"&&i!=="inline"&&(s=a.outerHeight(),o=a.outerWidth(),u?(r.top=Math.min(r.top,n.top),r.right=Math.max(r.right,n.left+o),r.bottom=Math.max(r.bottom,n.top+s),r.left=Math.min(r.left,n.left)):(r={top:n.top,right:n.left+o,bottom:n.top+s,left:n.left},u=!0));if(!u){n=e.offset(),r={top:n.top,right:n.left,bottom:n.top,left:n.left},n=t.offset(),s=t.height();if(r.top+s<=n.top){r.bottom=n.top;var f=this.parentLeftRight(e);f&&(r.left=f.left,r.right=f.right)}else r.bottom=n.top+s,r.right=n.left}return r},parentLeftRight:function(e){var t=e.parents(),n=0;for(;n<t.length&&t.eq(n).css("display")==="inline";n++);if(n===t.length)return;var r=t.eq(n),i=r.offset(),s=i.left+parseInt(r.css("margin-left"))+parseInt(r.css("border-left-width")),o=s+r.innerWidth();return{left:s,right:o}},displayFn:function(e){if(e.bottom){if(e.left)return this.bottomLeft;if(e.right)return this.bottomRight}else if(e.top){if(e.left)return this.topLeft;if(e.right)return this.topRight}},setLocationClass:function(e,t){this.$tooltip.addClass(r.point[e==="top"?"bottom":"top"]).addClass(r.point[t])},clearLocationClass:function(){["top","bottom","left","right"].forEach(function(e){this.$tooltip.removeClass(r.point[e])},this)},topLeft:function(e,t,n,r){this.position({top:this.visibleTop(t,n,e.top-n-this.tipPointHeight),left:this.visibleLeft(t,r,e.left-this.tipPointOffset)},"top","left")},topRight:function(e,t,n,r){this.position({top:this.visibleTop(t,n,e.top-n-this.tipPointHeight),left:this.visibleLeft(t,r,e.right-r+this.tipPointOffset)},"top","right")},bottomLeft:function(e,t,n,r){this.position({top:this.visibleTop(t,n,e.bottom+this.tipPointHeight),left:this.visibleLeft(t,r,e.left-this.tipPointOffset)},"bottom","left")},bottomRight:function(e,t,n,r){this.position({top:this.visibleTop(t,n,e.bottom+this.tipPointHeight),left:this.visibleLeft(t,r,e.right-r+this.tipPointOffset)},"bottom","right")},position:function(t,n,r){var i=e("body");this.$tooltip.css("top",t.top).css("left",t.left),this.setLocationClass(n,r)},visibleTop:function(e,t,n){return Math.min(e.bottom-t-this.tipPointHeight,Math.max(e.top+this.tipPointHeight,n))},visibleLeft:function(e,t,n){return Math.min(e.right-t-this.tipPointOffset,Math.max(e.left+this.tipPointOffset,n))},tipPointOffset:16,tipPointHeight:8,tipBoxHeight:18,tipBoxWidth:9})}),define("layoutviewer",["class","tabbox","pageview","handleview","layouthighlighter"],function(e,t,n,r,i){return e.extend(t,{constructor:function(e,t){this.super.constructor.call(this);var s=new i;this.pageView=this.addTab(new n(e,t,s)),this.addTab(new r(e,t)),this.activateTab(this.pageView)}})}),define("fileview",["class","tabcontent","cssclass","ace/ace"],function(e,t,n,r){var i=n.generate("fileview",["action","disabled"]),s=r.require("ace/range"),o=r.require("ace/token_iterator");return e.extend(t,{constructor:function(e,t,n){this.super.constructor.call(this,this.filename(t.path),null,!0,t.path),this.editor=e,this.fileinfo=t,n?this.customizer=n:this.mousemove=this.click=function(){},this.setLine(t.line)},add:function(){var e;switch(this.fileinfo["mime-type"]){case"text/x-php":e="php";break;case"text/xml":e="xml";break;default:e="text"}this.session=r.createEditSession(this.fileinfo.content,"ace/mode/"+e),this.customizer&&this.session.on("tokenizerUpdate",function(){this.customizer.setTokens(new o.TokenIterator(this.session,0,0)),this.setTokens=!0}.bind(this))},activate:function(){this.editor.setSession(this.session),this.gotoLine()},remove:function(){},gotoLine:function(){this.line&&(this.editor.gotoLine(this.line),this.editor.scrollToLine(this.line-1,!1,!1),delete this.line)},setLine:function(e){this.line=e},mousemove:function(e){if(!this.setTokens)return;var t=this.editor.renderer,n=t.rect=t.scroller.getBoundingClientRect(),r=(e.clientX+t.scrollLeft-n.left-t.$padding)/t.characterWidth,i=Math.floor((e.clientY+t.scrollTop-n.top)/t.lineHeight),s=Math.round(r),o={row:i,column:s,side:r-s>0?1:-1},u=this.session,a=u.screenToDocumentPosition(o.row,o.column),f=u.getTokenAt(a.row,a.column);if(f===this.token)return;this.token=f;if(this.marker){if(this.inMarker(this.marker,a))return;u.removeMarker(this.marker),this.marker=null}this.customize(f,a)},customize:function(e,t){var n=e?this.customizer.getAction(e,t):null;if(n){var r=new s.Range(n.row1,n.col1,n.row2,n.col2),o=n.action?i.action:i.disabled,u=n.type==="block"?"fullLine":"text";this.marker=this.session.addMarker(r,o,u,!0),this.action=n.action}else this.action=null},click:function(){this.action&&this.action()},inMarker:function(e,t){var n=this.editor.getSession().$frontMarkers[e];return n?n.range.contains(t.row,t.column):!1},getPath:function(){return this.fileinfo.path},currentLine:function(){return 1+this.editor.getSelectionRange().start.row},filename:function(e){return e.substr(1+e.lastIndexOf("/"))}})}),define("contextmenu",["jquery","cssclass","class"],function(e,t,n){var r=t.generate("contextmenu",["menu"]);return n.create({constructor:function(t){this.$menu=e("<ul />").addClass(r.menu),this.menuItems=t,this.mouseup=this.mouseup.bind(this)},addMenuItem:function(t,n){var r=e("<li />").text(n.label).appendTo(this.$menu);r.on("click",this.click.bind(this,t,n.action))},click:function(t,n){e(document).off("mouseup",this.mouseup),this.hide(),n(t)},attach:function(e){e.on("contextmenu",this.show.bind(this,e))},show:function(t,n){var r=e("body");n.preventDefault(),this.hide(),this.menuItems.forEach(this.addMenuItem.bind(this,t)),this.$menu.appendTo(e("body")),this.position(n.clientX,n.clientY),e(document).on("mouseup",this.mouseup)},position:function(t,n){var r=this.$menu,i=r.outerHeight(),s=r.outerWidth(),o=e("body"),u=t+o.scrollLeft(),a=n+o.scrollTop();n+i>window.innerHeight&&n>i&&(a-=i),t+s>window.innerWidth&&t>s&&(u-=s),r.css("top",a+"px").css("left",u+"px")},mouseup:function(t){t.which===1&&t.target.offsetParent!==this.$menu.get(0)&&(e(document).off("mouseup",this.mouseup),this.hide())},hide:function(){this.$menu.children().length&&(this.$menu.empty(),this.$menu.detach())}})}),define("remotecall",["jquery"],function(e){return{open:function(t,n){e.get("http://localhost:8091?message="+t+":"+n)}}}),define("fileviewer",["jquery","class","tabbox","ace/ace","fileview","contextmenu","remotecall"],function(e,t,n,r,i,s,o){return t.extend(n,{constructor:function(){this.super.constructor.call(this),e("<div />").attr("id","magedebugbar-fileviewer").addClass(this.activeClass()).appendTo(this.getContent()),this.createContextMenu()},createContextMenu:function(){this.contextMenu=new s([{label:"Open in Editor",action:this.openInEditor.bind(this)},{label:"Close",action:this.removeTab.bind(this)},{label:"Close Others",action:this.removeOtherTabs.bind(this)},{label:"Close All",action:this.removeAllTabs.bind(this)}])},openInEditor:function(e){var t=this.getTabContent(e);o.open(t.getPath(),t.currentLine())},appendTo:function(e){this.super.appendTo.call(this,e),this.editor=r.edit("magedebugbar-fileviewer"),this.editor.setReadOnly(!0),this.editor.setShowPrintMargin(!1),this.editor.setTheme("ace/theme/chrome"),this.editor.on("mousemove",this.mousemoveCombiner()),this.editor.on("click",this.click.bind(this))},load:function(e,t){var n=this.findTab(e.path);n?this.getTabContent(n).setLine(e.line):(n=this.addTab(new i(this.editor,e,t)),this.contextMenu.attach(n)),this.activateTab(n)},resize:function(){this.super.resize.call(this),this.editor&&this.editor.resize()},mousemoveCombiner:function(){var e;return this.timer=0,function(t){e=t,this.timer||(this.timer=window.setTimeout(function(){this.timer=0,this.mousemove(e)}.bind(this),100))}.bind(this)},mousemove:function(e){var t=this.getActiveView();t&&t.mousemove(e)},click:function(e){var t=this.getActiveView();t&&t.click(e)},findTab:function(e){var t=this.$tabs.children('li[title="'+e+'"]');if(t.length)return t},getActiveView:function(){var e=this.$tabs.children("."+this.activeClass());if(e.length)return this.getTabContent(e)}})}),define("resourceloader",["class"],function(e){return e.create({constructor:function(e){this.layoutModel=e,this.handlers=[]},registerHandler:function(e){return this.handlers[e.type]=e,this},loadStoreConfigFlag:function(e){this.load("store="+this.layoutModel.getStore()+"&config-flag="+e)},loadBlockClass:function(e,t){var n="block="+e;t&&(n+="&method="+t),this.load(n)},loadHelperClass:function(e,t){var n="helper="+e;t&&(n+="&method="+t),this.load(n)},loadHelper:function(e){var t=this.layoutModel.splitHelper(e);this.loadHelperClass(t.alias,t.method)},loadBlockMethod:function(e,t){var n=this.layoutModel.findBlock(e);if(n){var r=n.attrs.type;this.loadBlockClass(r,t)}},loadTemplate:function(e){var t=this.layoutModel.findTemplateFile(e);t&&this.loadFile(t)},loadBlock:function(e){var t=this.layoutModel.findBlock(e);t&&this.loadFile(this.layoutModel.configFileName(t.file),t.line)},loadFile:function(e,t){var n="file="+e;t&&(n+="&line="+t),this.load(n)},load:function(e){this.get(e).then(function(e){this.handleResponse(JSON.parse(e))}.bind(this)).catch(function(e){console.error(e)})},handleResponse:function(e){var t=this.handlers[e.type];t?t.handle(e):console.error("Unhandled response from host",e)},get:function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET","/magedebugbar.php?"+e),r.onload=function(){r.status==200?t(r.response):n(Error(r.statusText))},r.onerror=function(){n(Error("Network Error"))},r.send()})}})}),define("filehandler",["class"],function(e){return e.create({constructor:function(e){this.fileViewer=e,this.customizers=[]},type:"file",registerCustomizer:function(e){return this.customizers[e.mimetype]=e,this},handle:function(e){var t=this.customizers[e["mime-type"]];t?this.fileViewer.load(e,Object.create(t)):this.fileViewer.load(e)}})}),define("alerthandler",["class"],function(e){return e.create({type:"alert",handle:function(e){alert(e.message)}})}),define("layoutfileparser",["class"],function(e){return e.create({constructor:function(e,t){this.resourceLoader=e,this.layoutModel=t},parse:function(e){return this.actions=[],this.document(e),this.actions},attributes:function(e,t,n){t=t||[];var r;while(r=e.stepForward())switch(r.type){case"entity.other.attribute-name.xml":name=r.value;break;case"string.attribute-value.xml":var i=this.attributeValue(r.value);-1!==t.indexOf(name)?this[name+"Attribute"](e,i):n&&n.bind(this)(e,name,i);break;case"meta.tag.punctuation.tag-close.xml":var s=">"===r.value;return s||this.closeElement(),s}},elements:function(e,t,n){t=t||[];var r;while(r=e.stepForward())switch(r.type){case"meta.tag.tag-name.xml":this.openElement(),-1!==t.indexOf(r.value)?this[r.value+"Element"](e):n?n.bind(this)(e,r.value):this.anyElem(e);break;case"meta.tag.punctuation.end-tag-open.xml":this.closeElement(),this.endTag(e);return}},openElement:function(){this.level=this.level||0,this.level++},closeElement:function(){this.level--,this.popBlockNames()},attributeValue:function(e){return e.slice(1,-1)},anyElem:function(e){this.attributes(e)&&this.elements(e)},endTag:function(e){e.stepForward(),e.stepForward()},document:function(e){for(var t=e.getCurrentToken();t!==null;t=e.stepForward())if(t.value==="layout"&&t.type==="meta.tag.tag-name.xml"){this.layoutElement(e);break}},layoutElement:function(e){this.attributes(e)&&this.elements(e,[],this.handleElement)},handleElement:function(e,t){this.attributes(e)&&(this.layoutModel.validHandle(t)?this.elements(e,["block","reference","remove"]):this.disableHandle(e))},disableHandle:function(e){var t=e.getCurrentTokenRow();this.elements(e,[]);var n=e.getCurrentTokenRow();this.addAction(t,0,n,0)},blockElement:function(e){this.attributes(e,["type","template","before","after","module"],this.checkBlockNameAttribute)&&this.elements(e,["block","action","remove"])},referenceElement:function(e){this.attributes(e,["name"])&&this.elements(e,["block","action","remove"])},removeElement:function(e){this.attributes(e,["name"])&&this.elements(e)},actionElement:function(e){this.attributes(e,["method","module","ifconfig"])&&this.elements(e,[],this.paramsElement)},paramsElement:function(e,t){this.attributes(e,["helper"])&&this.elements(e)},nameAttribute:function(e,t){this.pushBlockName(t),this.nameAction(e,t)},checkBlockNameAttribute:function(e,t,n){"name"===t&&this.pushBlockName(n)},beforeAttribute:function(e,t){t!=="-"&&t!=="*"&&this.nameAction(e,t)},afterAttribute:function(e,t){t!=="-"&&t!="*"&&this.nameAction(e,t)},typeAttribute:function(e,t){this.newAction(e,t,this.willLoadBlockClass(t))},templateAttribute:function(e,t){var n=this.layoutModel.findTemplateFile(t),r=n?this.willLoadFile(n):null;this.newAction(e,t,r)},methodAttribute:function(e,t){var n=this.currentBlockName();this.newAction(e,t,this.willLoadBlockMethod(n,t))},moduleAttribute:function(e,t){this.newAction(e,t,this.willLoadHelperClass(t,"__"))},ifconfigAttribute:function(e,t){this.newAction(e,t,this.willLoadStoreConfigFlag(t))},helperAttribute:function(e,t){this.newAction(e,t,this.willLoadHelper(t))},nameAction:function(e,t){var n=this.layoutModel.findBlock(t)?this.willLoadBlock(t):null;this.newAction(e,t,n)},willLoadBlockClass:function(e){return this.resourceLoader.loadBlockClass.bind(this.resourceLoader,e)},willLoadFile:function(e){return this.resourceLoader.loadFile.bind(this.resourceLoader,e)},willLoadBlock:function(e){return this.resourceLoader.loadBlock.bind(this.resourceLoader,e)},willLoadBlockMethod:function(e,t){return this.resourceLoader.loadBlockMethod.bind(this.resourceLoader,e,t)},willLoadHelper:function(e){return this.resourceLoader.loadHelper.bind(this.resourceLoader,e)},willLoadHelperClass:function(e,t){return this.resourceLoader.loadHelperClass.bind(this.resourceLoader,e,t)},willLoadStoreConfigFlag:function(e){return this.resourceLoader.loadStoreConfigFlag.bind(this.resourceLoader,e)},newAction:function(e,t,n){var r=e.getCurrentTokenRow(),i=1+e.getCurrentTokenColumn(),s=i+t.length;this.addAction(r,i,r,s,n)},addAction:function(e,t,n,r,i){var s=e===n?"line":"block",o={row1:e,col1:t,row2:n,col2:r,action:i,type:s};for(var u=e;u<=n;u++)this.actions[u]=this.actions[u]||[],this.actions[u].push(o)},pushBlockName:function(e){this.blockNames=this.blockNames||[],this.blockNames.push({name:e,level:this.level})},popBlockNames:function(){this.blockNames=this.blockNames||[];while(this.blockNames.length&&this.blockNames[this.blockNames.length-1].level>this.level)this.blockNames.pop()},currentBlockName:function(){return this.blockNames[this.blockNames.length-1].name}})}),define("layoutfilecustomizer",["class","layoutfileparser"],function(e,t){return e.create({constructor:function(e,n){this.parser=new t(e,n)},mimetype:"text/xml",setTokens:function(e){this.actions=this.parser.parse(e)},getAction:function(e,t){var n=this.findAction(t);if(n)if(n.type==="block"||e.type==="string.attribute-value.xml")return n},findAction:function(e){var t=e.row,n=this.actions[t];if(n){var r=e.column,i=n.length;for(var s=0;s<i;s++){var o=n[s];if(o.type==="block")return o;if(r>o.col2+1)continue;if(r>=o.col1)return o;break}}}})}),define("layoutpanel",["jquery","class","cssclass","layoutmodel","layoutviewer","fileviewer","resourceloader","filehandler","alerthandler","layoutfilecustomizer"],function(e,t,n,r,i,s,o,u,a,f){var l=n.generate("layout",["panel","left","right","resize-handle"]);return t.create({constructor:function(t){this.$panel=t.addClass(l.panel),this.$left=e("<div />").addClass(l.left).appendTo(this.$panel),this.$resizehdle=e("<div />").addClass(l.resize.handle).appendTo(this.$panel),this.$right=e("<div />").addClass(l.right).appendTo(this.$panel),this.addResizeHandlers()},addResizeHandlers:function(){var e,t,n;n=this.$panel.css("cursor"),this.$resizehdle.on("mousedown",function(n){t=this.$left.width(),e=n.pageX,this.$panel.on("mousemove",r).on("mouseup",i),this.$panel.css("cursor","col-resize")}.bind(this));var r=function(n){var r=Math.min(this.$panel.width()-this.$resizehdle.width(),Math.max(100,t-e+n.pageX));this.$left.width(r),this.resize()}.bind(this),i=function(){this.$panel.off("mousemove",r).off("mouseup",i),this.$panel.css("cursor",n)}.bind(this)},setLayout:function(e){this.$left.children().remove(),this.$right.children().remove();var t=new r(e);this.fileviewer=new s,this.layoutviewer=new i(this.resourceLoader(t,this.fileviewer),t),this.layoutviewer.appendTo(this.$left),this.fileviewer.appendTo(this.$right),this.resize()},resize:function(){this.$right.css("margin-left",this.$left.width()+this.$resizehdle.width()),this.layoutviewer.resize(),this.fileviewer.resize()},resourceLoader:function(e,t){var n=new o(e),r=new u(t),i=new f(n,e);r.registerCustomizer(i);var s=new a;return n.registerHandler(r).registerHandler(s),n}})});var layoutTab=function(e,t){return t.Widget.extend({render:function(){require(["layoutpanel"],function(e){this.panel=new e(this.$el),this.layout&&(this.panel.setLayout(this.layout),this.resize())}.bind(this)),e("<div />").addClass("magedebugbar-padding-bottom").appendTo("body"),phpdebugbar.recomputeBottomOffset=function(){e(".magedebugbar-padding-bottom").height(e(".phpdebugbar").height()),this.resize()}.bind(this),e(window).on("resize",this.resize.bind(this)),this.bindAttr("data",function(e){this.panel?this.panel.setLayout(e):this.layout=e}.bind(this))},resize:function(){this.panel&&this.panel.resize()}})}(jQuery,PhpDebugBar);define("layouttab",function(){}),define("magedebugbar",function(){}),window.MageDebugBar={LayoutTab:layoutTab}})();